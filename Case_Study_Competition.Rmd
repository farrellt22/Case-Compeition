---
title: "Case Study competition"
author: "Thomas Farrell"
date: "3/23/2022"
output: pdf_document
toc : true
font size: 12pt

bibliography: citations.bib
---
## Cover Page

Report by:Thomas Farrell, Leo Salazar, Mia Brito, Raneen Aljamal


Primary Contact : Thomas Farrell (512) 400-9580

\newpage


## Executive Summary
|       This data set is collected directly from a fundraising agency and contains 95,412 records broken into 142 fields. The models shown related the efficiency of the different variables to predict if a consumer will donate to the campaign and if they donate it will predict how much they are likely to donate. We will use three different modeling techniques Linear Regression, Linear discriminant analysis(LDA) and Decision Tree modeling.

## Related Literature: 

When it comes to modeling approaches, it is crucial to pick the method that best satisfies your data’s needs. My team members and I have dove into the different types of modeling approaches to explore which method best fits our research. In our past case studies, we first explored logistic regression. As previously mentioned, Mitchell Dayton explains how logistic regression tackles the process of classifying problems. We also explored the use of a linear regression method. We learned that linear regression more commonly handles regression problems. To further enhance our knowledge of the different types of modeling approaches, we will be exploring the use of LDA and Decision Tree models in this case study.
Linear Discriminant Analysis, LDA, is another common modeling approach. LDA is commonly used to find a linear combination to separate more than two subjects or events. In Ricciardi, Valente, Edmund, Cantoni, Green, Fiorillo, Picone, Santini, and Cesarelli’s work, they used the LDA model to explore the use of a data mining technique to help clinicians in decision-making when it comes to Coronary Artery Disease. As previously mentioned, LDA models are used to separate two or more subjects. In this case study, they used the LDA model to classify the patients to help aid the decision making process. They concluded that this accelerated and enhanced the decision making process for doctors to choose the correct treatment for their patient. 
|       Similar to an LDA model, a Decision Tree model is used for classification purposes. A Decision Tree model builds regression by creating a model in a tree-like structure. It essentially makes the data set smaller by breaking it down into smaller subsets for an easier and quicker read. Stretch, Soares, and Moreira explored the use of a Decision Tree model when predicting the failure of students in University courses. They used the Decision Tree model to narrow down their data and make it smaller and were able to successfully explain the drop out phenomenon. 




## Data Anlaysis (Methodology)
Variable                    Description
--------------------------  ------------------------------------------
DateOfFirstGift             Origin Date. Date of donor's first gift
			    (YYMM). 
                           
State                       State abbreviation 
Zip                         Zipcode 
                           
DOB                         Date of birth (YYMM)
			     0 is missing

NeighborhoodCode
1st byte                      U=Urban
                              C=City
                              S=Suburban
                              T=Town
                              R=Rural
                           
2nd byte = Socio-Economic status of the neighborhood
                              1 = Highest SES
                              2 = Average SES
                              3 = Lowest SES 
(except for Urban communities, where 
                                  1 = Highest SES, 2 = Above average SES, 
                                  3 = Below average SES, 4 = Lowest SES.)                            
                          
Age                         Age 
                            empty if DOB = 0                           
                           
Home	                    Home Owner Flag
                            1 = Home owner 
                            0 = Unknown/Not home-owner
                        
NumberOfChildren            NUMBER OF CHILDREN 
			     empty implies no children
 
Income                      HOUSEHOLD INCOME in ten housands (10,000s)/yr.
			     empty means missing data

Gender                      Gender
                            M = Male
                            F = Female
                            U = Unknown
                            J = Joint Account, unknown gender
                          
PercVets                    % Males Veterans
PercEmpLoc                  % Employed by Local Gov
PercEmpState                % Employed by State Gov
PercEmpFed                  % Employed by Fed Gov
                           
--------------------------  -------------------------------------------------
The following variables reflect characteristics of the donors neighborhood, as collected from Census data.
                           
Persons                     Number of Persons
Fams                        Number of Families
Households                  Number of Households
PercPopUrban                Percent Population in Urbanized Area
PercPopRural                Percent Population Inside Rural Area
PercMale                    Percent Male
PercFemale                  Percent Female
PercWhite                   Percent White
PercBlack                   Percent Black
PercNatAm                   Percent Native American
PercIsleAsian               Percent Pacific Islander/Asian
PercHisp                    Percent Hispanic
PercAsianInd                Percent Asian Indian
PercJapa                    Percent Japanese
PercChin                    Percent Chinese
PercPhil                    Percent Pilipino
PercKor                     Percent Korean
PercViet                    Percent Vietnamese
PercHaw                     Percent Hawaiian
PercMex                     Percent Mexican
PercPurRic                  Percent Puerto Rican
PercCuba                    Percent Cuban

MedAge                      Median Age of Population
AvgAge                      Average Age of Population
AgeC1                       Percent Adults Age18-24
AgeC2                       Percent Adults Age 25-34
AgeC3                       Percent Adults Age 35-44
AgeC4                       Percent Adults Age 45-54
AgeC5                       Percent Adults Age 55-64
AgeC6                       Percent Adults Age 65-74
AgeC7                       Percent Adults Age >= 75

ChildC1                     Percent Children Age <=2
ChildC2                     Percent Children Age 3-5
ChildC3                     Percent Children Age 6-11

PercElder                   Percent Households w/ Person 65+ Living Alone

HHN1                        Percent 1 Person Households
HHN2                        Percent 2 Person Households
HHN3                        Percent 3 or More Person Households
HHN4                        Percent 4 or More Person Households
HHN5                        Percent 5 or More Person Households
HHN6                        Percent 6 Person Households

PercMarr                    Percent Married
PercSepDiv                  Percent Separated or Divorced
PercWid                     Percent Widowed
PercSingle                  Percent Never Married

MedHomeVal                  Median Home Value in hundreds
AvgHomeVal                  Average Home Value in hundreds

MedRent                     Median Rent in hundreds
AvgRent                     Average Rent in hundreds

MedHousInc                  Median Household Income in hundreds
MedFamInc                   Median Family Income in hundreds
AvgHousInc                  Average Household Income in hundreds
AvgFamInc                   Average Family Income in hundreds
PerCapInc                   Per Capita Income

IC1H                        Percent Households w/ Income < $15,000
IC2H                        Percent Households w/ Income $15,000 - $24,999
IC3H                        Percent Households w/ Income $25,000 - $34,999
IC4H                        Percent Households w/ Income $35,000 - $49,999
IC5H                        Percent Households w/ Income $50,000 - $74,999
IC6H                        Percent Households w/ Income $75,000 - $99,999
IC7H                        Percent Households w/ Income $100,000 - $124,999
IC8H                        Percent Households w/ Income $125,000 - $149,999
IC9H                        Percent Households w/ Income >= $150,000

IC1F                        Percent Families w/ Income < $15,000
IC2F                        Percent Families w/ Income $15,000 - $24,999
IC3F                        Percent Families w/ Income $25,000 - 34,999
IC4F                        Percent Families w/ Income $35,000 - $49,999
IC5F                        Percent Families w/ Income $50,000 - $74,999
IC6F                        Percent Families w/ Income $75,000 - $99,999
IC7F                        Percent Families w/ Income $100,000 - $124,999
IC8F                        Percent Families w/ Income $125,000 - $149,999
IC9F                        Percent Families w/ Income >= $150,000
PercSocSec                  Percent Households on Social Security

LFA                         Percent Adults in Labor Force
LFAM                        Percent Adult Males in Labor Force
LFAF                        Percent Females in Labor Force
LFAMEmp                     Percent Adult Males Employed
LFAFEMp                     Percent Adult Females Employed

PercProf                    Percent Professional
PercManage                  Percent Managerial
PercTech                    Percent Technical
PercSales                   Percent Sales
PercCler                    Percent Clerical/Administrative Support
PercFarm                    Percent Farmers
PercCraft                   Percent Craftsmen, Precision, Repair
PercMech                    Percent Operatives, Machine
PercTran                    Percent Transportation
PercLab                     Percent Laborers, Handlers, Helpers

EMP1                        Percent Employed in Agriculture
EMP2                        Percent Employed in Mining
EMP3                        Percent Employed in Construction
EMP4                        Percent Employed in Manufacturing
EMP5                        Percent Employed in Transportation
EMP6                        Percent Employed in Communications
EMP7                        Percent Employed in Wholesale Trade
EMP8                        Percent Employed in Retail Industry
EMP9                        Percent Employed in Finance, Insurance, R-Estate
EMP10                       Percent Employed in Business and Repair
EMP11                       Percent Employed in Personal Services
EMP12                       Percent Employed in Entertainment and Recreation
EMP13                       Percent Employed in Health Services
EMP14                       Percent Employed in Educational Services
EMP15                       Percent Employed in Other Professional Services
EMP16                       Percent Employed in Public Administration

MedEdu                      Median Years of School Completed by Adults 25+

Edu1                        Percent Adults 25+ Grades 0-8
Edu2                        Percent Adults 25+ w/ some High School
Edu3                        Percent Adults 25+ Completed High School 
Edu4                        Percent Adults 25+ w/ some College
Edu5                        Percent Adults 25+ w/ Associates Degree
Edu6                        Percent Adults 25+ w/ Bachelors Degree
Edu7                        Percent Adults 25+ Graduate Degree

PercForgnBr                 Percent Foreign Born
PercStateBr                 Percent Born in State of Residence

LangEng                     Percent English Only Speaking
LangSpa                     Percent Spanish Speaking
LangAs                      Percent Asian Speaking
LangOth                     Percent Other Language Speaking


--------------------------  -------------------------------------------------
The following fields are summary variables from the donation history file. 

LifeGiftDol                 Dollar amount of lifetime gifts to date
LifeGiftNum                 Number of lifetime gifts to date
LifeGiftPromNum             Number of lifetime gifts to promotions to date 
MinDol                      Dollar amount of smallest gift to date               
MaxDol                      Dollar amount of largest gift to date              
LastDol                     Dollar amount of most recent gift            
AvgDol                      Average dollar amount of gifts to date           

--------------------------  -------------------------------------------------
CustID                      Control number (unique record identifier)

Donation                    Target Variable: Binary Indicator for donation
AmDonated                   Target Variable: Donation Amount (in $) 
--------------------------  -------------------------------------------------


[@log1][@log2][@log3][@log4]







## Modeling Approaches



## Results



## Conclusions and Recommendations


\newpage

## Appendix

### Loading in libraries
```{r setup, message=FALSE, echo=TRUE}
library(varImp)
library(caret)
library(lattice)
library(ggplot2)
library(gam)
library(caret)
library(ROCR)
library(ggmosaic)
library(prettydoc)
library(tinytex)
library(corrplot)
library(MASS)
library(tidyverse)
library(esquisse)
library(lubridate)
library(modeldata)
library(leaps)
library(randomForest)
source('/Users/thomasfarrell/Downloads/optim_threshold.R')

```


### Reading in data


```{r}
b1 = read.csv("/Users/thomasfarrell/Downloads/Customer_Analytics_TrainTest.csv", sep = ",")
```



### Changing character variables to factors

```{r}
b1$State = as.factor(b1$State)
b1$NeighborhoodCode = as.factor(b1$NeighborhoodCode)
b1$Gender = as.factor(b1$Gender)
b1$Donation = as.factor(b1$Donation)
b1 = subset(b1, !is.na(b1$Age))
b1 = subset(b1, !is.na(b1$NumberOfChild))
b1 = subset(b1, !is.na(b1$Income))
b1 = dplyr::select(b1, - PercMale)
b1 = dplyr::select(b1, - PercFemale)
b1 = dplyr::select(b1, - PercWhite)
b1 = dplyr::select(b1, - PercIsleAsian)
b1 = dplyr::select(b1, - AgeC1)
b1 = dplyr::select(b1, - AgeC2)
b1 = dplyr::select(b1, - AgeC3)
b1 = dplyr::select(b1, - AgeC4)
b1 = dplyr::select(b1, - AgeC5)
b1 = dplyr::select(b1, - AgeC6)
b1 = dplyr::select(b1, - AgeC7)
b1 = dplyr::select(b1, - HHN1)
b1 = dplyr::select(b1, - HHN2)
b1 = dplyr::select(b1, - HHN4)
b1 = dplyr::select(b1, - PercMarr)
b1 = dplyr::select(b1, - PercSingle)
b1 = dplyr::select(b1, - MedHomeVal)
b1 = dplyr::select(b1, - MedFamInc)
b1 = dplyr::select(b1, - PerCapInc)
b1 = dplyr::select(b1, - IC2H)
b1 = dplyr::select(b1, - IC1F)
b1 = dplyr::select(b1, - IC2F)
b1 = dplyr::select(b1, - IC3F)
b1 = dplyr::select(b1, - IC4F)
b1 = dplyr::select(b1, - IC5F)
b1 = dplyr::select(b1, - IC6F)
b1 = dplyr::select(b1, - IC9F)
b1 = dplyr::select(b1, - EMP3)
b1 = dplyr::select(b1, - EMP4)
b1 = dplyr::select(b1, - EMP8)
b1 = dplyr::select(b1, - EMP9)
b1 = dplyr::select(b1, - EMP13)
b1 = dplyr::select(b1, - EMP14)
b1 = dplyr::select(b1, - Edu1)
b1 = dplyr::select(b1, - Edu2)
b1 = dplyr::select(b1, - Edu3)
b1 = dplyr::select(b1, - Edu4)
b1 = dplyr::select(b1, - Edu5)
b1 = dplyr::select(b1, - Edu6)
b1 = dplyr::select(b1, - Edu7)
b1 = dplyr::select(b1, - PercForgnBr)
b1 = dplyr::select(b1, - LangEng)
b1 = dplyr::select(b1, - LangSpa)
b1 = dplyr::select(b1, - LangAs)
b1 = dplyr::select(b1, - LangOth)
b1 = dplyr::select(b1, - AmDonated)
b1 = dplyr::select(b1, - NumberOfChild)
b1 = dplyr::select(b1, - PercEmpState)


str(b1)
```


### Removing highly correlated variables

```{r}
b1_num = dplyr::select_if(b1, is.numeric)
M = cor(b1_num)
highcorr = findCorrelation(M, cutoff = .9, names = TRUE)
b1 = dplyr::select(b1, - highcorr)
```




### Checking summary of target variable

```{r}
summary(b1$Donation)
```


```{r}
set.seed(1)
tr_ind = sample(nrow(b1),.8*nrow(b1), replace = F)
b1train = b1[tr_ind,]
b1test = b1[-tr_ind,]
```


```{r}
a1 = glm(formula = Donation ~ . , data = b1 , family = binomial)


car::vif(a1)
summary(a1)

predprob = predict.glm(a1, newdata = b1test, type = "response")
predclass_log = ifelse(predprob >= .05, "1", "0")
caret::confusionMatrix(as.factor(predclass_log), as.factor(b1test$Donation), positive = "1")

```


## Results


### Logistic Regression


```{r}
a1 = glm(formula = Donation ~ NeighborhoodCode + PercJapa + PercChin + AvgRent + IC3H + LFAF + MaxDol + LastDol, data = b1 , family = binomial)


car::vif(a1)
summary(a1)

predprob = predict.glm(a1, newdata = b1test, type = "response")
predclass_log = ifelse(predprob >= .1, "1", "0")
caret::confusionMatrix(as.factor(predclass_log), as.factor(b1test$Donation), positive = "1")
```




```{r}
optim_threshold(a1,b1, b1$Donation)
```


```{r}
m2.log = step(a1, direction = "backward")
summary(m2.log)

car::vif(m2.log)
```





### LDA Model


```{r}
m1.lda = lda(formula = Donation ~ PercJapa + PercChin + IC3H + LFAF + LastDol, data = b1train)
predclass_lda = predict(m1.lda, newdata = b1test)
caret::confusionMatrix(as.factor(predclass_lda$class),as.factor(b1test$Donation), positive = "1") 
```




### Decision Tree


```{r}
library(rpart.plot)
library(rpart)
library(caTools)
set.seed(123)
split = sample.split(b1$Donation, SplitRatio = 0.8)
b1train = subset(b1, split == TRUE)
b1test = subset(b1, split == FALSE)

tree.b1train <- rpart(formula = Donation ~ NeighborhoodCode + PercJapa + PercChin + AvgRent + IC3H + LFAF + MaxDol + LastDol,
                       data = b1train,control =rpart.control(minsplit =150,minbucket=1,cp=0))

rpart.plot(tree.b1train)                     
```

```{r}
summary(tree.b1train)
```

